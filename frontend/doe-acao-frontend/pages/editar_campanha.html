<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Roboto&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>DoeAção</title>
</head>

<body>
    <!--Navbar-->
    <nav class="navbar">
        <a class="navbar-brand" href="/pages/home.html">
            <p>Doe<br>Ação</p>
        </a>

        <button class="navbar-toggler first-button" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent20" aria-controls="navbarSupportedContent20" aria-expanded="false"
            aria-label="Toggle navigation">
            <div class="animated-icon1"><span></span><span></span><span></span></div>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent20">

            <ul class="navbar-nav mr-auto ">
                <li class="nav-item active">
                    <a class="nav-link" href="/pages/cadastro_campanha.html" style="color: white;"><i
                            class="fa-solid fa-calendar"></i>Criar Campanha</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/pages/minhas_campanhas.html" style="color: white;"><i
                            class="fa-solid fa-box"></i>Minhas Campanhas</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" style="color: white;"><i
                            class="fa-solid fa-address-card"></i>Informações Pessoais</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" style="color: white;"><i class="fa-solid fa-gift"></i>Doe</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" style="color: white;"><i class="fa-solid fa-building"></i>Sobre Nós</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" style="color: white;"><i class="fa-solid fa-landmark"></i>Política e
                        Taxas</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" style="color: white;"><i
                            class="fa-solid fa-circle-question"></i>FAQ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" style="color: white;"><i class="fa-solid fa-briefcase"></i>Trabalhe
                        Conosco</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" style="color: white;"><i class="fa-solid fa-lock"></i>Alterar Senha</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/index.html" style="color: white;"><i
                            class="fa-solid fa-circle-arrow-left"></i>Sair</a>
                </li>
            </ul>
        </div>
    </nav>
    <!--Navbar-->


    <h1 class="titulo-pagina">Editar Campanha</h1>


    <!--Formulário Campanha-->
    <form id="cadastro-campanha-form" class="container px-4 p-2" action="">
        <img class="inserir-img-campanha" id="url_image" />
        <div class="mb-3">
            <input class="form-control inserir-img-campanha" id="inserir-img-campanha" placeholder="URL da sua imagem"
                type="text" required>
        </div>
        <div class="row p-1">
            <input class="input-default col" type="text" id="name_campaign" required>
        </div>
        <div class="row p-1">
            <input class="input-default col" class="col" id="target_value" type="number" required>
        </div>
        <div class="row p-1">
            <input class="input-default col" type="text" id="beneficiary" required>
        </div>
        <div class="row row-cols-2">
            <div class="p-1">
                <input class="input-small col col-mobile" id="account_agency" type="text" required>
            </div>
            <div class="p-1">
                <input class="input-small col col-mobile" id="account_identification" type="text" required>
            </div>
        </div>
        <div class="row p-1">
            <input class="input-default col col-mobile" id="bank_name" type="text" required>
        </div>
        <div class="row p-1">
            <textarea class="input-default col col-mobile" id="campaign_description" required></textarea>
        </div>
        <div class="row p-1">
            <button type="submit" class="button-default col">Salvar</button>
        </div>
        <a class="cancelar" href="/pages/pagina_campanha.html">Voltar</button>
            <a class="deletar" href="/pages/campanha_cancelada.html" onclick="cancelCampaign()">Cancelar
                Campanha</button>
    </form>
    <!--Formulário Campanha-->



    <!--Scripts-->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="/javascript/scripts.js"></script>
    <script src="https://kit.fontawesome.com/e04a0ccd25.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        window.onload = function () {
            console.log(localStorage.getItem('id_user'))
            var currentCampaign = JSON.parse(getCampaignById());
            document.getElementById("name_campaign").value = currentCampaign['name_campaign'];
            document.getElementById("target_value").value = currentCampaign['target_value'];
            document.getElementById("beneficiary").value = currentCampaign['beneficiary'];
            document.getElementById("bank_name").value = currentCampaign['bank_name'];
            document.getElementById("account_agency").value = currentCampaign['account_agency'];
            document.getElementById("account_identification").value = currentCampaign['account_identification'];
            document.getElementById("campaign_description").value = currentCampaign['campaign_description'];
            document.getElementById("url_image").src = currentCampaign['url_image'];
            document.getElementById("inserir-img-campanha").value = currentCampaign['url_image'];
        }

        function getCampaignById() {
            var currentCampaignId = JSON.parse(localStorage.getItem('current_campaign_id'));
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", `https://app-doeacao.herokuapp.com/doeacao/campaigns/${currentCampaignId}`, false);
            xmlHttp.send(null);
            return xmlHttp.responseText;
        }

        function cancelCampaign() {
            var currentCampaignId = JSON.parse(localStorage.getItem('current_campaign_id'));
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("DELETE", `https://app-doeacao.herokuapp.com/doeacao/campaigns/${currentCampaignId}`, false);
            xmlHttp.send(null);
            return xmlHttp.responseText;
        }

        $('#cadastro-campanha-form').on('submit', function (event) {
            var dict = {
                "name_campaign": document.getElementById("name_campaign").value,
                "target_value": document.getElementById("target_value").value,
                "beneficiary": document.getElementById("beneficiary").value,
                "bank_name": document.getElementById("bank_name").value,
                "account_agency": document.getElementById("account_agency").value,
                "account_identification": document.getElementById("account_identification").value,
                "campaign_description": document.getElementById("campaign_description").value,
                "url_image": document.getElementById("inserir-img-campanha").value,
            };

            const serialize_form = form => JSON.stringify(dict);
            event.preventDefault();
            const json = serialize_form(this);
            var currentCampaignId = JSON.parse(localStorage.getItem('current_campaign_id'));

            $.ajax({
                type: 'PUT',
                url: `https://app-doeacao.herokuapp.com/doeacao/campaigns/${currentCampaignId}`,
                dataType: 'json',
                data: json,
                contentType: 'application/json',
                async: false
            });

            alert("Campanha atualizada!");
            window.location.href = "/pages/pagina_campanha.html";
        });
    </script>
    <!--Scripts-->
</body>

</html>